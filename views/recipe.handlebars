<!-- Search form -->
<form id="searchForm" action="/api/recipe" method="GET">
    <input id="searchInput" type="text" name="q" placeholder="Search for a recipe">
    <input id="nextPageHref" type="hidden" name="nextHref" value="{{this.nextHref}}"> <!-- This is the hidden input that will store the nextHref -->
    <button id="searchButton" type="submit" value="Search">Search</button>
</form>

<!-- Creates cards for each recipe -->
<div id="recipeCards">
    {{#each recipes}}
        <div class="card">
            <img src="{{this.image}}" alt="{{this.label}}">
            <h2 class="card">{{this.title}}</h2>
            <a href="{{this.url}}" target="_blank">View Recipe</a>
            <p class="ingredients">Ingredients:</p>
            <ol class="ingredientLines">
                {{#each this.ingredientLines}}
                    <li>{{this}}</li>
                {{/each}}
            </ol>
            <button class="save-recipe" data-recipe-id="{{this.id}}">Save Recipe</button>
            <button class="save-ingredients" data-recipe-uri="{{this.uri}}">Save Ingredients</button>
        </div>
    {{/each}}

    {{#if this.nextHref}}
    <button id="nextPage">Next Page</button>
    {{/if}}
</div>

<script>
    const form = document.getElementById('searchForm');
    const nextButton = document.getElementById('nextPage');

    nextButton.addEventListener('click', (e) => {
        e.preventDefault();
        form.submit();
    });

//-----------------------------------------------------------------------------//

const saveRecipesButtons = document.querySelectorAll('.save-ingredients');

saveRecipesButtons.forEach(button => {
    button.addEventListener('click', function() {
        
        let uri = this.getAttribute('data-recipe-uri');
        uri = encodeURIComponent(uri);
        //pass the uri to ingredients route
        fetch(`/ingredients?uri=${uri}`, {
            method: 'GET'
        })
        .then((response) => response.json())
        .then((data) => {
            console.log(data);
        })
        .catch((error) => {
            console.error('Error:', error);
        });

    });
});




</script>